<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<title>>>>Cube<<<</title>
	<style>
	body { margin: 0; padding:0;overflow:hidden;}
	canvas { width: 100%; height: 100% }
	</style>
</head>
<body>
	<script src="js/three.js"></script>
	<script src="loaders/OBJLoader.js"></script>
	<script src="loaders/MTLLoader.js"></script>
	<script src="loaders/OrbitControls.js"></script>
	<script>
	var camera, scene, renderer, light, pointlight;
	var geometry, material, mesh, loader, controls;

	function init() {


		// camera
		camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 0.01, 20 );
		camera.position.y = 0.5;
		camera.position.z = 5;


		// Scene
		scene = new THREE.Scene();

		// Lights
		var ambient = new THREE.AmbientLight( 0x404040 );
		scene.add( ambient );
		pointlight = new THREE.PointLight(0xffffff, 1);
		pointlight = new THREE.PointLight(0xffffff, 0.64);
		camera.add ( pointlight );
		scene.add ( camera );

		// Scene controls
		controls = new THREE.OrbitControls( camera );
		controls.addEventListener( 'change',  function(){
			controls.rotateSpeed = 1;
			controls.enableZoom = false;

			controls.minPolarAngle = 0; // radians
			controls.maxPolarAngle = 1.4; // radians
		});

		// Audio listener
		var listener = new THREE.AudioListener();
		camera.add( listener );

		// Create a global audio source
		var sound = new THREE.Audio( listener );

		// Load a sound and set it as the Audio object's buffer
		var audioLoader = new THREE.AudioLoader();
		audioLoader.load( 'audio/lane8.mp3', function( buffer ) {
			sound.setBuffer( buffer );
			sound.setVolume( 0.5 );
			sound.play();
		});

		// Toy car model
		var objLoader = new THREE.OBJLoader();
		var mtlLoader = new THREE.MTLLoader();
		// Loading material
		mtlLoader.load('materials/basiccar.mtl', function(materials){
			objLoader.setMaterials(materials);
			materials.preload();
			// Loading model/mesh
			objLoader.load('models/basiccar.obj', function ( obj ) {
				mesh = obj;
				mesh.visible = false;
				// Access to each child in mesh array
				obj.traverse(function(child){
					if (child instanceof THREE.Mesh) {
						// ruedas, aciento, aerol
						mesh.children[0].material.color.setHex(0x808080);
						// luces
						mesh.children[1].material.color.setHex(0xffffff);
						// barandas
						mesh.children[2].material.color.setHex(0x808080);
						// accesorios
						mesh.children[3].material.color.setHex(0x808080);
						// chasis
						mesh.children[4].material.color.setHex(0xff0000);
					}
				});
				scene.add( mesh );
			});
		});

		// Real car model
		var objLoaderOther = new THREE.OBJLoader();
		var mtlLoader = new THREE.MTLLoader();
		// Loading material
		mtlLoader.load('materials/realcar.mtl', function(materials){
			objLoaderOther.setMaterials(materials);
			materials.preload();
			// Loading model/mesh
			objLoaderOther.load('models/realcar.obj', function ( obj ) {
				mesh = obj;
				mesh.position.y = -.4;
				scene.add( obj );
			});
		});

		// Floor plane
		var texture = new THREE.TextureLoader().load('materials/grass.jpg');
		var geometry = new THREE.PlaneGeometry(20, 20, 32, 32);
		var material = new THREE.MeshPhongMaterial({ map: texture, side: THREE.DoubleSide });
		plane = new THREE.Mesh(geometry, material);
		plane.position.set(0, -.4, 0);
		plane.rotation.x = THREE.Math.degToRad(90);
		plane.name = "plane";
		scene.add(plane);

		// Render DOM
		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );

	}

	// Setting window height and width size
	window.onresize = function(){
		console.log("Window size: "+window.innerWidth+"x"+window.innerHeight+"px");
		renderer.setSize(window.innerWidth,window.innerHeight);
		var aspectRatio = window.innerWidth/window.innerHeight;
		camera.aspect = aspectRatio;
		camera.updateProjectionMatrix();

	}

	// animation
	function animate() {
		requestAnimationFrame( animate );
		renderer.render( scene, camera );
		controls.update();

	}

	init();
	animate();

	</script>
</body>
</html>
