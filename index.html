<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>>>>Cube<<<</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script src="loaders/OBJLoader.js"></script>
    <script src="loaders/MTLLoader.js"></script>
		<script src="loaders/OrbitControls.js"></script>
		<script>
      var camera, scene, renderer, light, pointlight;
      var geometry, material, mesh, loader, controls;

      function init() {


        // camara
        camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 0.01, 20 );
        camera.position.y = 0.5;
        camera.position.z = 5;


        // escena
        scene = new THREE.Scene();

        // luces
				var ambient = new THREE.AmbientLight( 0x404040 );
		    scene.add( ambient );
        pointlight = new THREE.PointLight(0xffffff, 0.9);
        camera.add ( pointlight );
        scene.add ( camera );

        // JSON

        // var loader = new THREE.JSONLoader();
        // loader.load('models/fullrobot.json', handle_load);
        //
        // function handle_load(geometry, material){
        //   var material = new THREE.MeshNormalMaterial();
        //   var mesh = new THREE.Mesh(geometry, material);
        //   scene.add(mesh);
        //   mesh.position.z = -1;
        // }



				var mtlLoader = new THREE.MTLLoader();
				mtlLoader.load('models/basiccar.mtl', function(materials){
					materials.preload();
					var objLoader = new THREE.OBJLoader();
					objLoader.setMaterials(materials);

					objLoader.load('models/basiccar.obj', function ( obj ) {
						mesh = obj;
						 obj.traverse(function(child){
							if (child instanceof THREE.Mesh) {
								// ruedas, aciento, aerol
								mesh.children[0].material.color.setHex(0x808080);
								// luces
								mesh.children[1].material.color.setHex(0xffffff);
								// barandas
								mesh.children[2].material.color.setHex(0x808080);
								// accesorios
								mesh.children[3].material.color.setHex(0x808080);
								// chasis
								mesh.children[4].material.color.setHex(0xff0000);
							}
					 	 });

					 	scene.add( mesh );
					});

				});
				var Ground_geometry = new THREE.BoxGeometry( 20, -0.8, 10 );
				var Ground_material = new THREE.MeshPhongMaterial( {
						color: 0xa0adaf,
						shininess: 150,
						specular: 0xffffff,
						shading: THREE.SmoothShading
				} );

				var ground = new THREE.Mesh( Ground_geometry, Ground_material );
				ground.scale.multiplyScalar( 1 );
				ground.castShadow = false;
				ground.receiveShadow = true;
				scene.add( ground );



        // adición del modelado y el material
				// var mymaterial = new THREE.MTLLoader();
				//
				// mymaterial.load('materials/megane3rs.mtl');
				//
        // mesh = new THREE.Mesh( geometry, material );
        // mymaterial.add( mesh );

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );
/*

        // MESH LOADER
				var material = new THREE.MeshBasicMaterial({color: 0xff0000});
        var loader = new THREE.OBJLoader(mesh, material);

        loader.load(
        'models/megane3rs.obj',
          // Cuando el recurso esta cargado
          function ( obj ) {
          mesh = obj;
          scene.add( mesh );
          }
       );
*/
      }
			// create an AudioListener and add it to the camera

			window.onresize = function(){
				console.log("Window size: "+window.innerWidth+"x"+window.innerHeight+"px");
				renderer.setSize(window.innerWidth,window.innerHeight);
				var aspectRatio = window.innerWidth/window.innerHeight;
				camera.aspect = aspectRatio;
				camera.updateProjectionMatrix();

			}
      // animación
      function animate() {
        requestAnimationFrame( animate );
				controls = new THREE.OrbitControls( camera, renderer.domElement );
				this.controls.rotateSpeed = 0.02;
				this.controls.enableZoom = false;
				this.controls.maxPolarAngle = Math.PI;

				var listener = new THREE.AudioListener();
				camera.add( listener );

				// create a global audio source
				var sound = new THREE.Audio( listener );

				// load a sound and set it as the Audio object's buffer
				var audioLoader = new THREE.AudioLoader();
				audioLoader.load( 'loaders/lane8.mp3', function( buffer ) {
					sound.setBuffer( buffer );
					sound.setVolume( 0.5 );
					sound.play();
				});

        // if (mesh != null) {
        //   mesh.rotation.y += 0.002;
        // }

        //mesh.rotation.y = -Math.PI/4;

        renderer.render( scene, camera );
				controls.update();
      }

      init();
      animate();

		</script>
	</body>
</html>
